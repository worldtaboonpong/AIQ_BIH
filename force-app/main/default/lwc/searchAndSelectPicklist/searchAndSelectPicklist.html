<template>
    <div>
        <template if:true={isLoading}>
            <lightning-spinner alternative-text="Loading"></lightning-spinner>
        </template>
        <template if:true={label}>
            <label for="combobox-id" class="slds-form-element__label">{label}</label>
        </template>
        <div class="slds-combobox_container">
            <div
                class="slds-combobox slds-dropdown-trigger slds-dropdown-trigger_click"
                aria-expanded={isDropdownOpen}
                aria-haspopup="listbox"
                role="combobox"
            >
                <div class="slds-combobox__form-element slds-input-has-icon slds-input-has-icon_right" role="none">
                    <lightning-input
                        disabled={disabled}
                        class="inputBox"
                        placeholder="Select Option"
                        value={searchString}
                        onblur={handleBlur}
                        onclick={showOptions}
                        onkeyup={filterOptions}
                        id="combobox-id"
                        variant="label-hidden"
                    ></lightning-input>
                    <lightning-icon
                        class="slds-input__icon"
                        icon-name="utility:down"
                        size="x-small"
                        alternative-text="search"
                    ></lightning-icon>
                </div>

                <!-- Dropdown visibility controlled by isDropdownOpen -->
                <template if:true={isDropdownOpen}>
                    <div class="slds-dropdown slds-dropdown_length-5 slds-dropdown_fluid">
                        <ul class="slds-listbox slds-listbox_vertical recordListBox" role="presentation">
                            <template if:false={message}>
                                <template for:each={options} for:item="option">
                                    <li
                                        key={option.value}
                                        class="slds-listbox__item eachItem {option.isVisible ? '' : 'slds-hide'}"
                                        onclick={selectItem}
                                    >
                                        <template if:true={option.selected}>
                                            <lightning-icon
                                                class=""
                                                icon-name="utility:check"
                                                size="x-small"
                                                alternative-text="icon"
                                            ></lightning-icon>
                                        </template>
                                        <span
                                            class="slds-media slds-listbox__option_entity verticalAlign slds-truncate"
                                        >
                                            {option.label}
                                        </span>
                                    </li>
                                </template>
                            </template>
                            <template if:true={message}>
                                <li class="slds-listbox__item">
                                    <span class="slds-media slds-listbox__option_entity verticalAlign slds-truncate">
                                        {message}
                                    </span>
                                </li>
                            </template>
                        </ul>
                    </div>
                </template>
            </div>
        </div>
    </div>
</template>
